# name: Build and Deploy Hugo

# on:
#   push:
#     branches:
#       - dev
#   repository_dispatch:
#     types: [content-updated]
#   workflow_dispatch:

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     timeout-minutes: 5  # Hugo быстрее Eleventy
    
#     steps:
#       - name: Checkout dev branch
#         uses: actions/checkout@v4
#         with:
#           ref: dev
        
#       - name: Setup Hugo
#         uses: peaceiris/actions-hugo@v2
#         with:
#           hugo-version: '0.131.0'
#           extended: true
      
#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'
      
#       - name: Install dependencies
#         run: npm ci --prefer-offline --no-audit --no-fund --silent
        
#       - name: Build Hugo site
#         env:
#           R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
#           R2_ACCESS_KEY_ID: ${{ secrets.R2_ACCESS_KEY_ID }}
#           R2_SECRET_ACCESS_KEY: ${{ secrets.R2_SECRET_ACCESS_KEY }}
#           R2_ENDPOINT: ${{ secrets.R2_ENDPOINT }}
#           R2_BUCKET_NAME: ${{ secrets.R2_BUCKET_NAME }}
#           CLIENT_ID: ${{ secrets.CLIENT_ID }}
#         run: |
#           cd hugo-migration
#           hugo --minify --environment production
        
#       - name: Deploy to main branch
#         uses: peaceiris/actions-gh-pages@v3
#         with:
#           github_token: ${{ secrets.GITHUB_TOKEN }}
#           publish_dir: ./hugo-migration/public
#           publish_branch: main
#           user_name: 'github-actions[bot]'
#           user_email: 'github-actions[bot]@users.noreply.github.com'
#           force_orphan: true
#           disable_nojekyll: true
