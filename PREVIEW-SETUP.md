# üéØ Preview –±–µ–∑ –∏–∑—ä—è–Ω–æ–≤ - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚úÖ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

**Cloudflare Pages Function** –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ preview —Å–∞–π—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤:
- ‚úÖ URL: `https://your-site.pages.dev/preview/{clientId}`
- ‚úÖ –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ R2 –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –Ω–∞ –ª–µ—Ç—É (0 —Å–µ–∫—É–Ω–¥)
- ‚úÖ –ù–∏–∫–∞–∫–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –í—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

---

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. Environment Variables –≤ Cloudflare Pages

–ó–∞–π–¥–∏ –≤ Cloudflare Dashboard ‚Üí Pages ‚Üí —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí Settings ‚Üí Environment Variables

**–î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –≤ GitHub Secrets):**

```
R2_ENDPOINT = https://xxxxx.r2.cloudflarestorage.com
R2_ACCESS_KEY_ID = xxxxxxxxxxxxx
R2_SECRET_ACCESS_KEY = xxxxxxxxxxxxx
R2_BUCKET_NAME = your-bucket-name
```

**–í–ê–ñ–ù–û:** –î–æ–±–∞–≤—å –¥–ª—è –æ–±–æ–∏—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π:
- ‚úÖ Production
- ‚úÖ Preview

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Functions

```bash
cd website-code

# –£–±–µ–¥–∏—Å—å —á—Ç–æ @aws-sdk/client-s3 –≤ dependencies (–Ω–µ –≤ devDependencies!)
npm install @aws-sdk/client-s3 --save
```

### 3. –î–µ–ø–ª–æ–π

```bash
git add functions/
git add PREVIEW-SETUP.md
git commit -m "Add instant preview via Cloudflare Pages Functions"
git push origin dev
```

Cloudflare Pages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç `/functions/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.

---

## üìñ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
–ö–ª–∏–µ–Ω—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∞–¥–º–∏–Ω–∫–µ
  ‚Üì
–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ R2
  ‚Üì
–ö–ª–∏–µ–Ω—Ç –∂–º–µ—Ç "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä LIVE"
  ‚Üì
–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è https://site.pages.dev/preview/{userId}
  ‚Üì
Cloudflare Pages Function:
  1. –ß–∏—Ç–∞–µ—Ç config.json –∏–∑ R2
  2. –ß–∏—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML (—Ç–µ –∂–µ —à–∞–±–ª–æ–Ω—ã —á—Ç–æ —É Eleventy)
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  ‚Üì
–ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —Å–∞–π—Ç –ú–ì–ù–û–í–ï–ù–ù–û (0 —Å–µ–∫—É–Ω–¥!)
```

### **–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Preview –∏ Production:**

| | Preview | Production |
|---|---------|------------|
| **URL** | `/preview/{userId}` | `/{userId}` |
| **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** | R2 (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏) | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML (–∏–∑ –±–∏–ª–¥–∞) |
| **–°–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞** | Instant (0 —Å–µ–∫) | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ (CDN) |
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | 20 —Å–µ–∫ (–±–∏–ª–¥) |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | –î–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π |

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏

Cloudflare Pages Functions —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Ö —Å–µ—Ä–≤–µ—Ä–µ, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```bash
cd website-code
node -c functions/preview/[clientId].js
# –ï—Å–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ ‚Üí –≤—Å—ë –æ–∫
```

### 2. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –ê–¥–º–∏–Ω–∫–∞ ‚Üí Dashboard ‚Üí "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä LIVE"
2. –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º –±–∞–Ω–Ω–µ—Ä–æ–º –≤–≤–µ—Ä—Ö—É:
   ```
   üëÅÔ∏è –†–ï–ñ–ò–ú –ü–†–ï–î–ü–†–û–°–ú–û–¢–†–ê | –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   ```
3. –ò–∑–º–µ–Ω–∏ —á—Ç–æ-—Ç–æ –≤ –∞–¥–º–∏–Ω–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞)
4. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É preview ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –°–†–ê–ó–£!
5. –ñ–º–∏ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å" ‚Üí —á–µ—Ä–µ–∑ 20 —Å–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ production URL

---

## üéØ Workflow –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

### **–û–±—ã—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**

```
1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∞–¥–º–∏–Ω–∫–µ
   ‚îî‚îÄ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   
2. –ñ–º–µ—Ç "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä LIVE" (–Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞)
   ‚îî‚îÄ –í–∏–¥–∏—Ç –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç INSTANTLY
   ‚îî‚îÄ –ú–æ–∂–µ—Ç –æ—Å–≤–µ–∂–∏—Ç—å preview ‚Üí –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   
3. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –¥–∞–ª—å—à–µ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç preview ‚Üí —Å–º–æ—Ç—Ä–∏—Ç
   ‚îî‚îÄ –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø–æ–∫–∞ –Ω–µ —É—Å—Ç—Ä–æ–∏—Ç
   
4. –ö–æ–≥–¥–∞ –≤—Å—ë —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç ‚Üí "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"
   ‚îî‚îÄ 20 —Å–µ–∫ ‚Üí —Å–∞–π—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ production
```

---

## üêõ Troubleshooting

### **"Configuration not found"**

–†–µ—à–µ–Ω–∏–µ:
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `config.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ R2
- –ü—É—Ç—å: `clients/{userId}/data/config.json`
- –°–æ–∑–¥–∞–π —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É ‚Üí Settings ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏

### **"Error: Access Denied"**

–†–µ—à–µ–Ω–∏–µ:
- –ü—Ä–æ–≤–µ—Ä—å Environment Variables –≤ Cloudflare Pages
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–µ –∂–µ —á—Ç–æ –≤ GitHub Secrets
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### **–°—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è**

–†–µ—à–µ–Ω–∏–µ:
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `/assets/css/style.css` –¥–æ—Å—Ç—É–ø–µ–Ω
- Cloudflare Pages –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ Tailwind (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ CDN)

### **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è**

–†–µ—à–µ–Ω–∏–µ:
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ R2 bucket –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —á—Ç–µ–Ω–∏—è
- –ò–ª–∏ –æ–±–Ω–æ–≤–∏ URL –≤ —Ñ—É–Ω–∫—Ü–∏–∏:
  ```javascript
  const R2_PUBLIC_URL = 'https://pub-xxxxxx.r2.dev';
  ```

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å preview" –ø—Ä—è–º–æ –≤ preview

```javascript
// –í renderHeader() –¥–æ–±–∞–≤—å:
<button 
  onclick="window.location.reload()" 
  class="bg-purple-600 text-white px-4 py-2 rounded"
>
  üîÑ –û–±–Ω–æ–≤–∏—Ç—å
</button>
```

### 2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```javascript
// –í preview banner:
<div class="preview-banner">
  üëÅÔ∏è PREVIEW | –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru')}
</div>
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å" –≤ preview

–°–¥–µ–ª–∞—Ç—å POST –∑–∞–ø—Ä–æ—Å –∫ –∞–¥–º–∏–Ω–∫–µ:
```javascript
<button onclick="publish()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ production</button>
<script>
  async function publish() {
    await fetch('https://admin-panel.vercel.app/api/build/trigger', {
      method: 'POST',
      credentials: 'include'
    });
    alert('–ü—É–±–ª–∏–∫—É–µ—Ç—Å—è! –ü–æ–¥–æ–∂–¥–∏—Ç–µ 20 —Å–µ–∫—É–Ω–¥.');
  }
</script>
```

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–°–∫–æ—Ä–æ—Å—Ç—å:**
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: ~200-500ms (—á–∏—Ç–∞–µ—Ç R2)
- Cloudflare –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç (—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ)
- –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ~200-500ms (—Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ)

### **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- 1 –∫–ª–∏–µ–Ω—Ç = 200ms
- 1000 –∫–ª–∏–µ–Ω—Ç–æ–≤ = 200ms (–∫–∞–∂–¥—ã–π)
- Serverless = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π scaling

### **–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- Cloudflare Pages Functions: **100,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –ë–ï–°–ü–õ–ê–¢–ù–û**
- R2 –æ–ø–µ—Ä–∞—Ü–∏–∏: –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö free tier
- **–ò—Ç–æ–≥–æ: $0/–º–µ—Å** ‚úÖ

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ë—ã–ª–æ:**
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è (20 —Å–µ–∫) ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞
- –ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è (20 —Å–µ–∫) ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞
- –î–æ–ª–≥–æ –∏ –Ω–µ—É–¥–æ–±–Ω–æ ‚ùå

**–°—Ç–∞–ª–æ:**
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí Preview INSTANT ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞
- –ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí Refresh preview (0 —Å–µ–∫) ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞
- –£—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è (20 —Å–µ–∫) ‚Üí Production –≥–æ—Ç–æ–≤ ‚úÖ

**UX —É–ª—É—á—à–∏–ª—Å—è –≤ 10 —Ä–∞–∑!** üöÄ

---

## ‚úÖ Checklist –¥–µ–ø–ª–æ—è

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `/functions/preview/[clientId].js`
- [ ] Environment Variables –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Cloudflare Pages
- [ ] –ö–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–≤–µ–¥–µ—Ç –Ω–∞ `/preview/{userId}`)
- [ ] –ó–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ó–∞–ø—É—à–µ–Ω–æ –≤ GitHub
- [ ] Cloudflare Pages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: preview —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!** ‚úÖ

