<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ page.title or client.site.title }}</title>
	<meta name="description" content="{{ page.description or client.site.description }}">

	<!-- Tailwind CSS CDN -->
	<script src="https://cdn.tailwindcss.com"></script>

	<!-- Custom CSS -->
	<link rel="stylesheet" href="/assets/css/style.css">
</head>

<body class="antialiased">
	<main>
		{% set currentPage = null %}
		{% set pageSlug = page.url | replace('/', '') or 'index' %}

		{# Находим текущую страницу в данных #}
		{% set currentUrl = page.url | replace('/index.html', '/') | replace('//', '/') %}
		{% set currentPage = null %}

		<!-- Debug: currentUrl = {{ currentUrl }} -->
		<!-- Debug: page.url = {{ page.url }} -->

		{# Специальная логика для главной страницы #}
		{% if currentUrl == '/' or currentUrl == '/index.html' %}
		{% for pageData in client.pages %}
		{% if pageData.slug == '/' %}
		{% set currentPage = pageData %}
		<!-- Debug: Found home page -->
		{% endif %}
		{% endfor %}
		{% else %}
		{# Для остальных страниц - убираем слеш в конце #}
		{% set cleanUrl = currentUrl | replace('/', '') %}
		{% for pageData in client.pages %}
		{% set cleanSlug = pageData.slug | replace('/', '') %}
		<!-- Debug: Comparing {{ pageData.slug }} ({{ cleanSlug }}) with {{ currentUrl }} ({{ cleanUrl }}) -->
		{% if pageData.slug == currentUrl or cleanSlug == cleanUrl %}
		{% set currentPage = pageData %}
		<!-- Debug: Found page {{ pageData.slug }} -->
		{% endif %}
		{% endfor %}
		{% endif %}

		<!-- Debug: currentPage = {{ currentPage.slug if currentPage else 'null' }} -->

		{# Если не нашли, используем главную страницу #}
		{% if not currentPage %}
		{% set currentPage = client.pages[0] %}
		{% endif %}

		{# Рендерим секции #}
		{% if currentPage and currentPage.sections %}
		{% for section in currentPage.sections %}
		{% if section.enabled and section.type != 'header' and section.type != 'footer' %}
		{% include "components/" + section.type + ".njk" %}
		{% endif %}
		{% endfor %}
		{% endif %}
	</main>

	<!-- Main JS -->
	<script type="module" src="/assets/js/main.js"></script>
</body>

</html>